@model Instrumusicals.Models.User

@{
    ViewData["Title"] = "Profile";
}

<div class="modal text-center" tabindex="-1" role="dialog" style="background-color: rgba(255,255,255,0.2);">
    <div class="modal-dialog" role="document">
        <div class="modal-content bg-dark">
            <div class="modal-header justify-content-center">
                <h5 id="moadlHeader" class="modal-title text-light text-center">Modal title</h5>
            </div>
            <div class="modal-body text-light">
                <p id="modalMessage"></p>
            </div>
            <div class="modal-footer justify-content-center">
                <button type="button" id="modalClose" class="btn w-75">OK!</button>
            </div>
        </div>
    </div>
</div>

<div class="row text-center justify-content-center">
    <div class="w-50">
        <span class="text-secondary">Hello</span>
        <h1 class="text-primary" style="text-shadow: 2px 2px 20px #ff6a00;">
            <cite>        
                @Context.User.Claims.Where(c => c.Type == "FullName").Select(c => c.Value).SingleOrDefault()!
            </cite>
        </h1>
        <span class="text-secondary">Welcome to your profile</span>
        <br />
        <div class="btn-group m-3" role="group" aria-label="Basic example">
            <button id="btnProfile" type="button" class="btn btn-secondary">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person" viewBox="0 0 16 16">
                    <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z" />
                </svg>
                Profile
            </button>
            <button id="btnOrders" type="button" class="btn btn-secondary">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil" viewBox="0 0 16 16">
                    <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z" />
                </svg>
                Orders
            </button>
            <button id="btnReviews" type="button" class="btn btn-secondary">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat" viewBox="0 0 16 16">
                    <path d="M2.678 11.894a1 1 0 0 1 .287.801 10.97 10.97 0 0 1-.398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8.06 8.06 0 0 0 8 14c3.996 0 7-2.807 7-6 0-3.192-3.004-6-7-6S1 4.808 1 8c0 1.468.617 2.83 1.678 3.894zm-.493 3.905a21.682 21.682 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a9.68 9.68 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9.06 9.06 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105z" />
                </svg>
                Reviews
            </button>
            <button id="btnSecurity" type="button" class="btn btn-secondary">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-lock" viewBox="0 0 16 16">
                    <path d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2zM5 8h6a1 1 0 0 1 1 1v5a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V9a1 1 0 0 1 1-1z" />
                </svg>
                Security
            </button>
        </div>
    </div>
</div>

<div id="dynamicContent" class="row text-center w-100  justify-content-center" style="width:100px;">

    <div id="profileContent" class="w-50 row justify-content-center">
        <a class="text-warning" asp-action="Edit" asp-route-id="@Model.Id">Edit Profile</a>
        <div class="card bg-dark border border-light m-4" style="width: 18rem;">
            <ul class="list-group list-group-flush m-3">
                <li class="list-group-item bg-dark text-light">@Model.FirstName @Model.LastName</li>
                <hr />
                <li class="list-group-item bg-dark text-light">@Model.Email</li>
                <hr />
                <li class="list-group-item bg-dark text-light">@Model.Address</li>
            </ul>
        </div>
    </div>



    <div id="ordersContent" class="d-none m-3 w-75 row justify-content-center">
        <div class="row justify-content-center text-center w-75"><button id="btnToggleSearch" class="btn text-primary border border-primary w-25" style="border-radius:100px; transition: width 2s !important;">search my orders</button></div>
        <div id="viewSearchParams" class="row justify-content-center text-center d-none">
            <div class="w-100 m-2 row justify-content-center">
                <div class="w-75 align-middle row justify-content-center">
                    <input type="hidden" id="uid" value="@Context.User.Claims.Where(c => c.Type == "Uid").Select(c => c.Value).SingleOrDefault()" />
                    
                    <div class="w-50 d-flex justify-content-around">
                        <div>
                            <label class="text-secondary">Created Date Starting From</label>
                            <input type="date" id="fCreate" name="fCreated" class="m-1 form-control text-center text-light bg-dark border border-primary" style="border-radius:100px;" autocomplete="off" />
                        </div>

                        <div>
                            <label class="text-secondary">Created Date Up To</label>
                            <input type="date" id="tCreate" name="tCreated" class="m-1 form-control text-center text-light bg-dark border border-primary" style="border-radius:100px;" autocomplete="off" />
                        </div>
                    </div>
                    
                    <div class="w-50 d-flex justify-content-around">
                        <div>
                            <label class="text-secondary">Shipping Date From</label>
                            <input type="date" id="fShipping" name="fShipping" class="m-1 form-control text-center text-light bg-dark border border-primary" style="border-radius:100px;" autocomplete="off" />
                        </div>

                        <div>
                            <label class="text-secondary">Shipping Date Up To</label>
                            <input type="date" id="tShipping" name="tShipping" class="m-1 form-control text-center text-light bg-dark border border-primary" style="border-radius:100px;" autocomplete="off" />
                        </div>
                    </div>

                    <input type="number" id="lPrice" name="lPrice" placeholder="From Total $" class="w-25 m-2 form-control text-center text-light bg-dark border border-primary" style="border-radius:100px;" autocomplete="off" />

                    <input type="number" id="uPrice" name="uPrice" placeholder="To Total $" class="w-25 m-2 form-control text-center text-light bg-dark border border-primary" style="border-radius:100px;" autocomplete="off" />
                    <div class="row justify-content-center">
                        <input type="text" id="address" name="address" placeholder="To Address" class="w-25 m-2 form-control text-center text-light bg-dark border border-primary" style="border-radius:100px;" autocomplete="off" />
                    </div>
                    <div class="w-25 d-flex align-middle justify-content-around m-3">
                        <button id="btnOrdersSearch" class="btn text-success m-1" style="border-radius:100px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16" >
                                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
                            </svg>
                        </button>
                        <div id="ordersLoader" class="spinner-border text-light d-none" role="status"></div>
                        <button id="btnOrdersClear" class="btn m-1 btn-sm text-danger border-0" style="border-radius:100px;">Clear</button>
                    </div>
                </div>
            </div>
        </div>
        <table class="table text-light">
            <thead>
                <tr>
                    <th>Created</th>
                    <th>Shipping Address</th>
                    <th>TotalPrice</th>
                    <th>Shipping Date</th>
                </tr>
            </thead>
            <tbody id="ordersTable">
                @foreach (var item in Model.Orders.OrderBy(o => o.Shipping))
                {
                    <tr>
                        <td>@item.Create.ToString("dd/MM/yyyy")</td>
                        <td>@Html.DisplayFor(modelItem => item.Address)</td>
                        <td>@Html.DisplayFor(modelItem => item.TotalPrice)$</td>
                        <td>@item.Shipping.ToString("dd/MM/yyyy")</td>
                        <td>
                            <a class="text-warning" asp-controller="Orders" asp-action="Edit" asp-route-id="@item.Id">Edit</a> |
                            <a class="text-primary" asp-controller="Orders" asp-action="Details" asp-route-id="@item.Id">Details</a>
                            @if (Context.User != null && Context.User.IsInRole("Admin"))
                            {<span> | </span><a class="text-danger" asp-controller="Reviews" asp-action="Delete" asp-route-id="@item.Id">Delete</a>}
                        </td>
                    </tr>

                }
            </tbody>
        </table>
    </div>


    <div id="reviewsContent" class="d-none m-3">
        <h3>My Reviews</h3>
        <table class="table text-light">
            <thead>
                <tr>
                    <th>Instrument</th>
                    <th>Content</th>
                    <th>Last Update</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.Reviews.OrderByDescending(r => r.LastUpdate))
                {
                    <tr>
                        <td><a class="text-light" asp-action="Details" asp-controller="Instruments" asp-route-id="@item.Instrument.Id"><cite class="text-info">@Html.DisplayFor(modelItem => item.Instrument.Name)</cite></a></td>
                        <td>@Html.DisplayFor(modelItem => item.Content)</td>
                        <td>@Html.DisplayFor(modelItem => item.LastUpdate)</td>
                        <td>
                            <a class="text-warning" asp-controller="Reviews" asp-action="Edit" asp-route-id="@item.Id">Edit</a> |
                            <a class="text-primary" asp-controller="Reviews" asp-action="Details" asp-route-id="@item.Id">Details</a> |
                            <a class="text-danger" asp-controller="Reviews" asp-action="Delete" asp-route-id="@item.Id">Delete</a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <div id="securityContent" class="d-none m-3">
        <h3>Keep Safe!</h3>
        <button id="btnToggleChangePw" class="btn btn-danger btn-sm m-3" style="border-radius:100px">
            Change Password
        </button>
        <div class=" row text-center justify-content-center">
            <div id="newPwDetails" class="w-25 text-center d-none justify-content-center">
                <input type="password" id="currPwInput" class="form-control text-light bg-dark m-2 text-center border border-warning" placeholder="Current Password" style="border-radius:100px;" />
                <input type="password" id="newPwInput" class="form-control text-light bg-dark m-2 text-center border border-success" placeholder="New Password" style="border-radius:100px;" />
                <input type="password" id="confirmPwInput" class="form-control text-light bg-dark m-2 text-center border border-success" placeholder="Confirm New Password" style="border-radius:100px;" />
                <div class="row justify-content-center">
                    <div style="width:30px; height:30px;">
                        <div id="changePwSpinner" class="d-none">
                            <div class="spinner-border text-light" role="status" style="width:15px; height:15px">
                            </div>
                        </div>
                    </div>
                </div>
                <button id="submitChangePw" onclick="changePassword(@Context.User.Claims.Where(c => c.Type == "Uid").Select(c => c.Value).SingleOrDefault())"
                        class="w-25 btn bg-transparent text-danger border border-2 border-danger btn-sm m-1" style="border-radius:100px;">
                    submit
                </button>
            </div>
        </div>
    </div>
</div>

<script type="text/template" id="orderRowTemplate">
    <tr>
        <td>${create}</td>
        <td>${address}</td>
        <td>${totalPrice}$</td>
        <td>${shipping}</td>
        <td>
            <a class="text-warning" href="/Orders/Edit/${id}">Edit</a> |
            <a class="text-primary" href="/Orders/Details/${id}">Details</a>
            @if (Context.User != null && Context.User.IsInRole("Admin"))
            {<span> | </span><a class="text-danger" href="/Orders/Delete/${id}">Delete</a>}
        </td>
    </tr>
</script>
<link rel="stylesheet" href="~/css//instruVisual.css">

@section Scripts{
    <script src="~/js/Users/ProfileViewController.js"></script>

    <script src="~/js/Users/ChangePassword.js"></script>

    <script src="~/js/Orders/SearchOrders.js"></script>
}